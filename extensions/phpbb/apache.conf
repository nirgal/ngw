<VirtualHost *:80>
    ServerName phpbb
    Redirect permanent / https://phpbb/
</VirtualHost>

<VirtualHost *:443>
    ServerName phpbb

    SSLEngine on
    SSLCertificateFile /usr/lib/ngw/https/ngw.crt
    SSLCertificateKeyFile /usr/lib/ngw/https/ngw.key
 
#    DBD module does not support groups. Disabled.
#    DBDriver pgsql
#    DBDParams "host=localhost dbname=ngw user=XXXXXXXX password=XXXXXXXX"
#    <Location "/">
#        AuthType Basic
#        # TODO: AuthType Digest require another password encryption scheme
#        AuthName "ngw"
#        AuthBasicProvider dbd
#        #AuthDigestProvider dbd
#        AuthDBDUserPWQuery "SELECT passwd FROM contact WHERE login = %s"
#        # The following line is used for "AuthType Digest" where the real is part of the md5 hash
#        #AuthDBDUserRealmQuery "SELECT passwd FROM contact WHERE login = %s"
#        #AuthDigestDomain https://nike.fr.gl3 https://niketest.fr.gl3 http://nike.fr.gl3 http://niketest.fr.gl3
#        Require valid-user
#    </Location>

    DocumentRoot "/usr/lib/ngw/extensions/phpbb/static/"
    AddDefaultCharset UTF-8
    ServerSignature Off
    CustomLog "/dev/null" " "
    ErrorLog "/usr/lib/ngw/apache_error.log"

    <Location "/">
        Auth_PG_host            localhost
        Auth_PG_port            5432
        Auth_PG_database        ngw
        Auth_PG_user            XXXXXXXX
        Auth_PG_pwd             XXXXXXXX
        Auth_PG_pwd_table       auth_users_bb
        Auth_PG_grp_table       auth_user_groups
        Auth_PG_uid_field       login
        Auth_PG_pwd_field       password
        Auth_PG_grp_user_field  login
        Auth_PG_grp_group_field gid
        Auth_PG_log_table       apache_log
        Auth_PG_log_uname_field login
        Auth_PG_log_date_field  lastconnection
        AuthType Basic
        AuthName "ngw"
        require valid-user
    </Location>
    <LocationMatch "^/logout">
        Allow from all
        Satisfy Any
    </LocationMatch>

    Include /etc/phpbb3/apache.conf

    PythonPath "['/usr/lib'] + sys.path"
    PythonHandler django.core.handlers.modpython
    SetEnv DJANGO_SETTINGS_MODULE ngw.settings
    PythonDebug On
    PythonAutoReload On
    <LocationMatch "^/hook_change_password$">
        SetHandler python-program
        require valid-user
    </LocationMatch>

</VirtualHost>

