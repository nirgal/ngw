{% extends "base.html" %}
{% load ngwtags %}

{% block body %}
<script>
function selectAll(target_checked) {
    inputs = document.getElementById("contact_list").elements;
    for (i=0; i<inputs.length; i++) {
        input = inputs[i];
        if (input.name.indexOf('contact_') == 0)
            input.checked = target_checked;
    }
}

function refreshSendTo() {
    link = '';
    inputs = document.getElementById("contact_list").elements;
    for (i=0; i<inputs.length; i++) {
        input = inputs[i];
        if (input.name.indexOf('contact_') == -1)
            continue;
        if (!input.checked)
            continue;
        if (!link)
            link += 'mailto:?bcc=';
        else
            link += ',';
        link += input.value;
    }
    /*alert(link);
    alert(document.getElementById("default").href);*/
    document.getElementById("default").href = link;
}

function onFocusTextArea() {
    /* That function erases the textarea on enter if it still contains the original text. */
    elmt = document.getElementById("messagetxt");
    if (elmt.value == 'Enter your message here.')
        elmt.value = '';
}

</script>

    <h1 class=boxheader>Memberships</h1>
    <div class=box>
    Include members: {% if display_member %}Yes{% else %}No{% endif %}
    -
    Include invited: {% if display_invited %}Yes{% else %}No{% endif %}
    -
    Include declined invitations: {% if display_declined %}Yes{% else %}No{% endif %}
    -
    Include subgroups: {% if display_subgroups %}Yes{% else %}No{% endif %}
    -
    Include admins: {% if display_admins %}Yes{% else %}No{% endif %}
    </div>
    {% if strfilter %}
    <h1 class=boxheader>Filter</h1>
    <div class=box>
    {{filter.to_html|safe}}<br>
    </div>
    {% endif %}

    <p>Don't forget to <b>use Bcc</b> whenever you can!

    <form id="contact_list" method="post">
    {% csrf_token %}

    <p>
    <a href="javascript:selectAll(true)">Select all</a> - <a href="javascript:selectAll(false)">Unselect all</a><br>
    {% for email in emails %}
    <input type=checkbox name="contact_{{email|get:0}}" id="contact_{{email|get:0}}" value="{{ email|get:2 }}" checked onchange='refreshSendTo()'> <label for="contact_{{email|get:0}}">{{email|get:1}} &lt;{{ email|get:2 }}&gt;</label><br>
    {% endfor %}

    {% if noemails %}
        <p>Warning, the following people does not have any email address:<br>
        {% for contact in noemails %}
        <a href="{{ contact.get_absolute_url }}">{{ contact.name }}</a><br>
        {% endfor %}
    {% endif %}

    <p>
    <textarea name=message id=messagetxt rows=20 onfocus='onFocusTextArea()'>Enter your message here.</textarea>

    {% block submitbar %}
    <div id=submitbar>
      <a href="mailto:?bcc={% for email in emails %}{% if forloop.counter0 %},{% endif %}{{ email|get:2 }}{% endfor %}" id=default>Use my program</a>
      <input type=submit value="Send from server">
    </div>
    {% endblock %}

    </form>
{% endblock %}
