Installation
============
It is recommanded to use Debian 6 (Squeeze) or above

aptitude install python-django python-psycopg2 postgresql libapache2-mod-wsgi libjs-jquery gettext pwgen python-uno python-cracklib tor python-socksipy oomailing python-decoratedstr

oomailing and python-decoratedstr packages can be downloaded at:
http://www.nirgal.com/debian/

You need python-django version 1.5, available in Debian stable-backports at:
http://packages.qa.debian.org/python-django

Base directory must be /usr/lib/ngw (make a symlink)

You need to edit your settings.py:
- Put your database user/password there
- Put something in SECRET_KEY:
  from django.utils.crypto import get_random_string
  get_random_string(50, 'abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*(-_=+)')

You need to set up a cron tab:
*/5 * * * * /usr/lib/ngw/manage.py msgsync -v 2

You also need to compile translation files:
cd core/;../manage.py compilemessages;cd -
cd extensions/externalmessages/;../../manage.py compilemessages;cd -

Postgres setup
==============

Create a user ngw (or something else):
  postgres@localhost:~$ createuser ngw --no-superuser --createdb --no-createrole

Set a password for it:
  postgres@localhost:~$ psql -c "\password ngw"

Create a database ngw with owner ngw:
  postgres@localhost:~$ createdb ngw -E unicode -O ngw

Create the structure, populate the initial data, and create the extra views and functions:
  $ psql -h localhost -U ngw ngw -f sql/structure.sql
  $ psql -h localhost -U ngw ngw -f sql/initialdata.sql
  $ psql -h localhost -U ngw ngw -f sql/functions.sql
  $ ./manage.py syncdb

This will create an admin account:
login: admin
password: hahlahT8

Please change it immediately.

Apache
======
Enable ssl in apache:
a2enmod ssl

Generate self-signed certificate:
openssl req -nodes -x509 -days 3650 -new -newkey rsa:2048 -subj /CN=ngw.example.net -keyout ngw.key -out ngw.crt

Listen on port 443
Add a new line "Listen 443" to /etc/apache2/ports.conf" if it's now there allready

Enable virtual hosts on https:
Add a new line "NameVirtualHost *:443" before "Listen 443"


Static files and thumbnails
===========================
aptitude install php5 php5-gd

user or group www-data should have write access to /var/lib/ngw/static/static/g so that thumbnails are generated only once.


Optionnal extensions
====================

* phpbb3 synchronisation

You can use ngw groups to manage phpbb3 permissions, so that some contacts will
automatically have access to some forums.
See extentions/phpbb3/README

* ejabberd synchronisation

You can have one group automatically grant access to a local ejabberd.
See extentions/xmpp/README

* mailman synchronisation

There is a small helper to list people to suscribe/unsusbribe to a mailman
server.
Code is currently mostly in core/

* gpg support

mkdir /var/lib/ngw
chown www-data /var/lib/ngw

Right now, keys needs to be imported by hand: gpg --homedir /var/lib/ngw/ --import akey.key

Add "Listen 11371" at the end of the /etc/apache2/ports.conf
to have an hkp:// compatible server (Download only)

Uncomment gpg keyring directory in settings.py (GPG_HOME)
