<VirtualHost *:80>
    ServerName ngw
    Redirect permanent / https://nike
</VirtualHost>

<VirtualHost *:443>
    ServerName ngw

    SSLEngine on
    SSLCertificateFile /usr/lib/ngw/https/nike.crt
    SSLCertificateKeyFile /usr/lib/ngw/https/nike.key
 
#    DBD module does not support groups. Disabled.
#    DBDriver pgsql
#    DBDParams "host=localhost dbname=ngw user=XXXXXXXX password=XXXXXXXX"
#    <Location "/">
#        AuthType Basic
#        # TODO: AuthType Digest require another password encryption scheme
#        AuthName "ngw"
#        AuthBasicProvider dbd
#        #AuthDigestProvider dbd
#        AuthDBDUserPWQuery "SELECT passwd FROM contact WHERE login = %s"
#        # The following line is used for "AuthType Digest" where the real is part of the md5 hash
#        #AuthDBDUserRealmQuery "SELECT passwd FROM contact WHERE login = %s"
#        #AuthDigestDomain https://nike.fr.gl3 https://niketest.fr.gl3 http://nike.fr.gl3 http://niketest.fr.gl3
#        Require valid-user
#    </Location>

    DocumentRoot "/usr/lib/ngw/static"
    AddDefaultCharset UTF-8
    ServerSignature Off
    CustomLog "/dev/null" " "
    ErrorLog "/usr/lib/ngw/apache_error.log"

    PythonPath "['/usr/lib'] + sys.path"

    <Directory "/usr/lib/ngw/static/static">
        AllowOverride AuthConfig
    </Directory>

    <Location "/">
        Auth_PG_host localhost
        Auth_PG_port 5432
        Auth_PG_database ngw
        Auth_PG_user XXXXXXXX
        Auth_PG_pwd XXXXXXXX
        Auth_PG_pwd_table auth_users
        Auth_PG_grp_table auth_user_groups
        Auth_PG_uid_field login
        Auth_PG_pwd_field password
        Auth_PG_grp_user_field login
        Auth_PG_grp_group_field gid
        AuthType Basic
        AuthName "ngw"
    </Location>

    Alias /media/ /usr/share/python-support/python-django/django/contrib/admin/media/

    <LocationMatch "^/logout$">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
    </LocationMatch>
    <LocationMatch "^/$">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
        require valid-user
    </LocationMatch>
    <LocationMatch "^/logs$">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
        require valid-user
    </LocationMatch>
    <Location "/contacts/">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
        require valid-user
    </Location>
    <Location "/contactgroups/">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
        require valid-user
    </Location>
    <Location "/contactfields/">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
        require valid-user
    </Location>
    <Location "/choicegroups/">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
        require valid-user
    </Location>
    <LocationMatch "^/test$">
        SetHandler python-program
        PythonHandler django.core.handlers.modpython
        SetEnv DJANGO_SETTINGS_MODULE ngw.settings
        PythonDebug On
        PythonAutoReload On
        require valid-user
    </LocationMatch>
</VirtualHost>

