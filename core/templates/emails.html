{% extends "base.html" %}
{% load i18n %}

{% block extrahead %}{{ block.super }}
<script>
function selectAll(target_checked) {
    inputs = document.getElementById("contact_list").elements;
    for (i=0; i<inputs.length; i++) {
        input = inputs[i];
        if (input.name.indexOf('contact_') == 0)
            input.checked = target_checked;
    }
}

function refreshSendTo() {
    link = '';
    inputs = document.getElementById("contact_list").elements;
    for (i=0; i<inputs.length; i++) {
        input = inputs[i];
        if (input.name.indexOf('contact_') == -1)
            continue;
        if (!input.checked)
            continue;
        if (!link)
            link += 'mailto:?bcc=';
        else
            link += ',';
        link += input.value;
    }
    /*alert(link);
    alert(document.getElementById("default").href);*/
    document.getElementById("default").href = link;
}

function onFocusTextArea() {
    /* That function erases the textarea on enter if it still contains the original text. */
    elmt = document.getElementById("messagetxt");
    if (elmt.value == '{% trans "Enter your message here." %}')
        elmt.value = '';
}
</script>
{% endblock %}

{% block submenu %}
{% include "group_submenu.html" %}
{% endblock %}

{% block content %}

    <h1 class=boxheader>{% trans "Memberships" %}</h1>
    <div class=box>
    {% trans "Include members" %}: {% if display_member %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}
    -
    {% trans "Include invited" %}: {% if display_invited %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}
    -
    {% trans "Include declined invitations" %}: {% if display_declined %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}
    -
    {% trans "Include subgroups" %}: {% if display_subgroups %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}
    -
    {% trans "Include admins" %}: {% if display_admins %}{% trans "Yes" %}{% else %}{% trans "No" %}{% endif %}
    </div>
    {% if strfilter %}
    <h1 class=boxheader>{% trans "Filter" %}</h1>
    <div class=box>
    {{filter.to_html|safe}}<br>
    </div>
    {% endif %}

    <p>{% trans "Don't forget to <b>use Bcc</b> whenever you can!" %}

    <form id="contact_list" method="post">
    {% csrf_token %}

    <p>
    <a href="javascript:selectAll(true)">{% trans "Select all" %}</a> - <a href="javascript:selectAll(false)">{% trans "Unselect all" %}</a><br>
    {% for cid,contact,email in emails %}
    <input type=checkbox name="contact_{{cid}}" id="contact_{{cid}}" value="{{ email }}" checked onchange='refreshSendTo()'> <label for="contact_{{cid}}">{{contact}} &lt;{{ email }}&gt;</label><br>
    {% endfor %}

    {% if noemails %}
        <p>{% trans "Warning, the following people does not have any email address" %}:<br>
        {% for contact in noemails %}
        <a href="{{ contact.get_absolute_url }}">{{ contact.name }}</a><br>
        {% endfor %}
    {% endif %}

    <p>
    <textarea name=message id=messagetxt rows=20 onfocus='onFocusTextArea()'>{% trans "Enter your message here." %}</textarea>

    {% block submitbar %}
    <div id=submitbar>
      <a href="mailto:?bcc={% for cid,contact,email in emails %}{% if forloop.counter0 %},{% endif %}{{ email }}{% endfor %}" id=default>{% trans "Use my program" %}</a>
      <input type=submit value="{% trans "Send from server" %}">
    </div>
    {% endblock %}

    </form>
{% endblock %}
