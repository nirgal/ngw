{% extends "contact_list.html" %}
{% load i18n staticfiles ngwtags %}

{% block submenu %}
{% include "group_submenu.html" %}
{% endblock %}

{% block prequerylist %}
<div class="module padded">
    {% if cg.description %}{{ cg.description|linebreaksbr }}<br>{% endif %}
    {% if cg.date %}<br>{% trans "Date" %}: <b>{{ cg.date|date:"DATE_FORMAT" }}</b>{% endif %}
    {% if cg.budget_code %}<br>{% trans "Budget code" %}: <b>{{ cg.budget_code }}</b>{% endif %}
    {% if cg.mailman_address %}<br>{% trans "Mailing list" %}: <b>{{ cg.mailman_address }}</b>{% endif %}
</div>
    {{ block.super }}
{% endblock %}

{% block extrafilter %}
    <script>
    function submit_display(form) {
        display="";
        if (form.id_display_member.checked) display+="m";
        if (form.id_display_invited.checked) display+="i";
        if (form.id_display_declined.checked) display+="d";
        if (form.id_display_subgroups.checked) display+="g";
        if (form.id_display_admins.checked) display+="a";
        document.forms['mainform'].display.value=display;
        document.forms['mainform'].submit();
    }
    </script>
    <form>{% trans "Show" %}:
    <input type=checkbox name="display_member" id="id_display_member" {% if display_member %}checked {% endif %}onchange="submit_display(this.form);"><label for="id_display_member">{% trans "Members" %}</label>
    <input type=checkbox name="display_invited" id="id_display_invited" {% if display_invited %}checked {% endif %}onchange="submit_display(this.form);"><label for="id_display_invited">{% trans "Invited people" %}</label>
    <input type=checkbox name="display_declined" id="id_display_declined" {% if display_declined %}checked {% endif %}onchange="submit_display(this.form);"><label for="id_display_declined">{% trans "Declined invitations" %}</label>
    <input type=checkbox name="display_subgroups" id="id_display_subgroups" {% if display_subgroups %}checked {% endif %}onchange="submit_display(this.form);"><label for="id_display_subgroups">{% trans "Include subgroups" %}</label>
    <input type=checkbox name="display_admins" id="id_display_admins" {% if display_admins %}checked {% endif %}onchange="submit_display(this.form);"><label for="id_display_admins">{% trans "Admins" %}</label>
    </form>
{% endblock %}

{% block presubmitbar %}
    {{ block.super }}
    {% ifnotequal cg.id 1 %}
        {% for sg in cg.get_direct_subgroups|group_visible_by:user.id %}
            {% if forloop.first %}
                <h1 class=boxheader>{% trans "Sub groups" %}</h1>
                <div class=box>
                    {% trans "People in sub-groups automatically are members / invited." %}
                    <br>
            {% endif %}
                    ‣ <a href="{{ sg.get_absolute_url }}">{{ sg.name_with_date }}</a>
                    {% for ssg in sg.get_subgroups|group_visible_by:user.id %}
                    {% if forloop.first %}( {% trans "including" %} {%else%}, {% endif %}
                    {{ ssg|group_with_link }}
                    {% if forloop.last %}){% endif %}
                    {% endfor %}
                    <br>
            {% if forloop.last %}
                </div>
            {% endif %}
        {% endfor %}
    {% endifnotequal %}
    
    {% for sg in cg.get_manager_groups|group_visible_by:user.id %}
        {% if forloop.first %}
            <h1 class=boxheader>{% trans "Groups that have some access to" %} {{ cg.name_with_date }}</h1>
            <div class=box>
        {% endif %}
                ‣ <a href="{{ sg.get_absolute_url }}">{{ sg.name_with_date }}</a><br>
        {% if forloop.last %}
            </div>
        {% endif %}
    {% endfor %}

    {% for p in cg.get_birthday_members %}
        {% if forloop.first %}
            <h1 class=boxheader>{% trans "Happy birthday to" %}</h1>
            <div class=box>
        {% endif %}
        ‣ {{ p }}<br>
        {% if forloop.last %}
            </div>
        {% endif %}
    {% endfor %}
{% endblock %}

    
{% block submitbar %}
<div class="submit-row" id=submitbar>
    <a class="button default" href="javascript:show_column_selection();"> {% trans "Select displayed columns" %}</a>
    <a class=button href="{{cg.get_absolute_url}}edit">{% trans "Edit" %}</a>
    <a class=button href="emails{{baseurl}}">{% trans "Emails" %}</a>
    <a class=button href="vcards{{baseurl}}">{% trans "Vcards" %}</a> 
    <a class=button href="csv{{baseurl}}">{% trans "CSV export" %}</a> 
    {% if cg.date %}
    {% else %}
    <a class=button href="add"><img src="{% static "admin/img/icon_addlink.gif" %}" border=0> {% trans "Create a new contact in that group" %}</a>
    {% endif %}
    <a class=button href="{{cg.get_class_absolute_url}}add_contacts_to?gid={{cg.id}}&amp;filter={{filter|escape_amp_query}}&amp;display={{display}}"><img src="{% static "admin/img/icon_addlink.gif" %}" border=0> {% trans "Add to another group" %}</a>
</div>
{% endblock %}
